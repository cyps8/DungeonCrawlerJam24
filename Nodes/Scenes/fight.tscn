[gd_scene load_steps=23 format=3 uid="uid://cchtk7sr6uooo"]

[ext_resource type="Script" path="res://Scripts/Game/Fight/Fight.gd" id="1_cintp"]
[ext_resource type="PackedScene" uid="uid://17pdg2ie4dcl" path="res://Nodes/FightAttacks/fight_attack.tscn" id="2_d1b4e"]
[ext_resource type="Texture2D" uid="uid://b7odef5c7rnsn" path="res://Assets/Art/Sprites/UI/heart.png" id="2_l8hvv"]
[ext_resource type="Script" path="res://Scripts/Game/Fight/FightCam.gd" id="2_s7c6h"]
[ext_resource type="Script" path="res://Scripts/Game/Fight/FightPlayer.gd" id="4_d0jw0"]
[ext_resource type="Script" path="res://Scripts/Game/Fight/FightHeart.gd" id="4_hi5wl"]
[ext_resource type="Texture2D" uid="uid://dw88lnbsuo8rj" path="res://Assets/Art/Sprites/UI/knife.png" id="4_yc4mu"]
[ext_resource type="PackedScene" uid="uid://b75tleqgb7y25" path="res://Nodes/Particles/heart_burst.tscn" id="5_2boef"]
[ext_resource type="Theme" uid="uid://u8pdlm3dg4w" path="res://Resources/Themes/MainTheme.tres" id="9_mbes3"]
[ext_resource type="Script" path="res://Scripts/Game/FightHUD.gd" id="9_t0wtu"]
[ext_resource type="Script" path="res://Scripts/Game/GameOver.gd" id="11_oearr"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_4xsiy"]
transparency = 1

[sub_resource type="PlaneMesh" id="PlaneMesh_mkaeu"]
material = SubResource("StandardMaterial3D_4xsiy")
size = Vector2(100, 100)

[sub_resource type="WorldBoundaryShape3D" id="WorldBoundaryShape3D_bkc8b"]

[sub_resource type="CylinderMesh" id="CylinderMesh_iocuw"]
top_radius = 0.01
bottom_radius = 0.225
height = 0.1
radial_segments = 24
rings = 1
cap_bottom = false

[sub_resource type="CylinderShape3D" id="CylinderShape3D_ijco0"]
height = 0.68808
radius = 0.249644

[sub_resource type="SphereShape3D" id="SphereShape3D_leab5"]
radius = 0.240626

[sub_resource type="QuadMesh" id="QuadMesh_ljjff"]
size = Vector2(0.05, 0.05)
orientation = 1

[sub_resource type="Curve" id="Curve_3l6l4"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 2

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_h0xmp"]
bg_color = Color(0.92549, 0.415686, 0.431373, 1)
border_width_right = 6
border_width_bottom = 10
border_color = Color(0.92549, 0.415686, 0.431373, 1)

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_57obp"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_073to"]
bg_color = Color(1, 1, 1, 1)
border_width_right = 6
border_width_bottom = 10
border_color = Color(0.92549, 0.415686, 0.431373, 1)

[node name="Fight" type="Node3D"]
script = ExtResource("1_cintp")
attackList = Array[PackedScene]([ExtResource("2_d1b4e")])

[node name="Floor" type="StaticBody3D" parent="."]

[node name="Mesh" type="MeshInstance3D" parent="Floor"]
mesh = SubResource("PlaneMesh_mkaeu")
skeleton = NodePath("../..")

[node name="Shape" type="CollisionShape3D" parent="Floor"]
shape = SubResource("WorldBoundaryShape3D_bkc8b")

[node name="GPUParticlesCollisionBox3D" type="GPUParticlesCollisionBox3D" parent="Floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0951538, -0.505277, 0)
size = Vector3(5, 1, 5)

[node name="Arm" type="SpringArm3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.642788, 0.766044, 0, -0.766044, 0.642788, 0, 0, 0)
collision_mask = 0
spring_length = 4.0

[node name="FightCam" type="Camera3D" parent="Arm"]
unique_name_in_owner = true
script = ExtResource("2_s7c6h")

[node name="Heart" type="Area3D" parent="." groups=["Heart"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
script = ExtResource("4_hi5wl")
heartBurst = ExtResource("5_2boef")

[node name="Sprite" type="Sprite3D" parent="Heart"]
billboard = 1
texture_filter = 0
texture = ExtResource("2_l8hvv")

[node name="Shadow" type="MeshInstance3D" parent="Heart/Sprite"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.152691, 0)
cast_shadow = 3
mesh = SubResource("CylinderMesh_iocuw")
skeleton = NodePath("../..")

[node name="Shape" type="CollisionShape3D" parent="Heart"]
shape = SubResource("CylinderShape3D_ijco0")

[node name="SpotLight3D" type="SpotLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 3.67885, 0)
shadow_enabled = true
shadow_bias = 0.0
shadow_normal_bias = 0.174
shadow_blur = 0.0
spot_range = 6.0
spot_attenuation = 0.0947324
spot_angle_attenuation = 1.56917

[node name="FightPlayer" type="CharacterBody3D" parent="."]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.25, 1)
motion_mode = 1
script = ExtResource("4_d0jw0")

[node name="Shape" type="CollisionShape3D" parent="FightPlayer"]
shape = SubResource("SphereShape3D_leab5")

[node name="Sprite" type="Sprite3D" parent="FightPlayer"]
axis = 1
alpha_cut = 1
texture_filter = 0
texture = ExtResource("4_yc4mu")

[node name="Burst" type="CPUParticles3D" parent="FightPlayer/Sprite"]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.213076, 0, 0)
cast_shadow = 3
emitting = false
lifetime = 0.5
one_shot = true
explosiveness = 1.0
mesh = SubResource("QuadMesh_ljjff")
direction = Vector3(-1, 0, 0)
gravity = Vector3(0, 0, 0)
initial_velocity_min = 2.0
initial_velocity_max = 2.0
linear_accel_min = -3.0
linear_accel_max = -3.0
scale_amount_curve = SubResource("Curve_3l6l4")

[node name="FightHUD" type="CanvasLayer" parent="."]
script = ExtResource("9_t0wtu")

[node name="Bars" type="Control" parent="FightHUD"]
layout_mode = 3
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -460.0
offset_top = 45.0
offset_right = 460.0
offset_bottom = 145.0
grow_horizontal = 2
pivot_offset = Vector2(460, 50)

[node name="HealthBarBack" type="ProgressBar" parent="FightHUD/Bars"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -399.0
offset_top = 19.0
offset_right = 400.0
offset_bottom = 85.0
grow_horizontal = 2
theme = ExtResource("9_mbes3")
theme_override_styles/fill = SubResource("StyleBoxFlat_h0xmp")
max_value = 1.0
value = 0.75
show_percentage = false

[node name="HealthBar" type="ProgressBar" parent="FightHUD/Bars"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -399.0
offset_top = 19.0
offset_right = 400.0
offset_bottom = 85.0
grow_horizontal = 2
theme = ExtResource("9_mbes3")
theme_override_styles/background = SubResource("StyleBoxEmpty_57obp")
theme_override_styles/fill = SubResource("StyleBoxFlat_073to")
max_value = 1.0
value = 0.5
show_percentage = false

[node name="GameOver" type="CanvasLayer" parent="."]
layer = 10
script = ExtResource("11_oearr")

[node name="c" type="Control" parent="GameOver"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme = ExtResource("9_mbes3")

[node name="Died" type="Label" parent="GameOver/c"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -592.0
offset_top = 83.0
offset_right = 592.0
offset_bottom = 360.0
grow_horizontal = 2
theme_override_colors/font_shadow_color = Color(0, 0, 0, 1)
theme_override_colors/font_outline_color = Color(0.92549, 0.415686, 0.431373, 1)
theme_override_constants/shadow_offset_x = 5
theme_override_constants/shadow_offset_y = 5
theme_override_constants/outline_size = 20
theme_override_constants/shadow_outline_size = 40
theme_override_font_sizes/font_size = 100
text = "YOU DIED..."
horizontal_alignment = 1
vertical_alignment = 1

[node name="RetryButton" type="Button" parent="GameOver/c"]
layout_mode = 0
offset_left = 633.0
offset_top = 690.0
offset_right = 921.0
offset_bottom = 830.0
text = "RETRY"

[node name="MenuButton" type="Button" parent="GameOver/c"]
layout_mode = 0
offset_left = 975.0
offset_top = 692.0
offset_right = 1263.0
offset_bottom = 832.0
text = "MAIN MENU"

[connection signal="body_entered" from="Heart" to="Heart" method="KnifeHurt"]
[connection signal="pressed" from="GameOver/c/RetryButton" to="GameOver" method="RetryButton"]
[connection signal="pressed" from="GameOver/c/MenuButton" to="GameOver" method="MainMenuButton"]
